Perfect âœ… â€” hereâ€™s your **backend prompt**, parallel to the frontend one.

This prompt tells exactly how to convert your current backend logic (or build it from scratch) into a **production-ready Express + MongoDB (Mongoose)** backend that powers your course/chapter/homework structure.

---

## ðŸš€ Backend Conversion / Build Prompt

Iâ€™m now sending you my existing backend files (or structure drafts).
Please convert everything into a **modern Express.js + MongoDB (Mongoose)** project using:

- **Express.js (latest)**
- **MongoDB + Mongoose ODM**
- **Node.js 20+**
- **Feature-based folder structure**
- **.env configuration** (with dotenv)
- **Validation with Joi or Zod**
- **CORS + Helmet + Morgan + Compression**
- **Async error handling middleware**
- **RESTful API structure**
- **Ready for connection with my Next.js frontend**

---

## ðŸ§± Project Goals

The backend must serve and manage data for:

- **Courses**
- **Chapters**
- **Homeworks**
- **Table of Contents (TOC)**

Each course has:

- `name`
- `author`
- `sectionCount`
- `description` (optional)
- references to `Chapters`

Each chapter belongs to a course and has:

- `chapterNumber` (like `"2.2"`)
- `chapterTitle`
- `sections[]` (subtitles + text + optional images)
- `homeworks[]` (array of homework refs or embedded)

Each homework belongs to a chapter and has:

- `homeworkId` (number)
- `homeworkTitle`
- `description`
- `help`
- `exampleCode`
- `answer`
- `hints[]`
- `resources[]`

---

## ðŸ§© Folder Structure (Feature-Based)

Use clean modular structure:

```
backend/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ db.js
â”‚   â”‚   â””â”€â”€ env.js
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ course.model.js
â”‚   â”‚   â”œâ”€â”€ chapter.model.js
â”‚   â”‚   â””â”€â”€ homework.model.js
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ course.controller.js
â”‚   â”‚   â”œâ”€â”€ chapter.controller.js
â”‚   â”‚   â””â”€â”€ homework.controller.js
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ course.routes.js
â”‚   â”‚   â”œâ”€â”€ chapter.routes.js
â”‚   â”‚   â””â”€â”€ homework.routes.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â”‚   â”œâ”€â”€ asyncHandler.js
â”‚   â”‚   â””â”€â”€ validateRequest.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ ApiResponse.js
â”‚   â”‚
â”‚   â”œâ”€â”€ app.js
â”‚   â””â”€â”€ server.js
â”‚
â”œâ”€â”€ .env
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## âš™ï¸ Core Features

### 1ï¸âƒ£ Course Endpoints

| Method   | Endpoint                 | Description                       |
| -------- | ------------------------ | --------------------------------- |
| `GET`    | `/courses`               | Get all courses                   |
| `POST`   | `/courses`               | Create a new course               |
| `GET`    | `/courses/:courseId`     | Get a single course with chapters |
| `PATCH`  | `/courses/:courseId`     | Update course                     |
| `DELETE` | `/courses/:courseId`     | Delete course                     |
| `GET`    | `/courses/:courseId/toc` | Get course Table of Contents      |

### 2ï¸âƒ£ Chapter Endpoints

| Method   | Endpoint                                 | Description                                    |
| -------- | ---------------------------------------- | ---------------------------------------------- |
| `GET`    | `/courses/:courseId/chapters`            | Get all chapters in a course                   |
| `POST`   | `/courses/:courseId/chapters`            | Add new chapter to a course                    |
| `GET`    | `/courses/:courseId/chapters/:chapterId` | Get specific chapter with sections & homeworks |
| `PATCH`  | `/courses/:courseId/chapters/:chapterId` | Update chapter                                 |
| `DELETE` | `/courses/:courseId/chapters/:chapterId` | Delete chapter                                 |

### 3ï¸âƒ£ Homework Endpoints

| Method   | Endpoint                                                       | Description                   |
| -------- | -------------------------------------------------------------- | ----------------------------- |
| `GET`    | `/courses/:courseId/chapters/:chapterId/homeworks`             | Get all homeworks for chapter |
| `POST`   | `/courses/:courseId/chapters/:chapterId/homeworks`             | Add homework to chapter       |
| `GET`    | `/courses/:courseId/chapters/:chapterId/homeworks/:homeworkId` | Get specific homework         |
| `PATCH`  | `/courses/:courseId/chapters/:chapterId/homeworks/:homeworkId` | Update homework               |
| `DELETE` | `/courses/:courseId/chapters/:chapterId/homeworks/:homeworkId` | Delete homework               |

---

## ðŸ§  Example Mongoose Schemas

### Course

```js
import mongoose from "mongoose";

const courseSchema = new mongoose.Schema(
  {
    name: { type: String, required: true },
    author: { type: String, required: true },
    sectionCount: { type: Number, default: 0 },
    description: String,
  },
  { timestamps: true }
);

export default mongoose.model("Course", courseSchema);
```

### Chapter

```js
import mongoose from "mongoose";

const chapterSchema = new mongoose.Schema(
  {
    courseId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Course",
      required: true,
    },
    chapterNumber: { type: String, required: true },
    chapterTitle: { type: String, required: true },
    sections: [
      {
        subTitle: String,
        description: String,
        imageUrl: String,
      },
    ],
  },
  { timestamps: true }
);

export default mongoose.model("Chapter", chapterSchema);
```

### Homework

```js
import mongoose from "mongoose";

const homeworkSchema = new mongoose.Schema(
  {
    courseId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Course",
      required: true,
    },
    chapterId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Chapter",
      required: true,
    },
    homeworkId: { type: Number, required: true },
    homeworkTitle: { type: String, required: true },
    description: String,
    help: String,
    exampleCode: String,
    answer: String,
    hints: [String],
    resources: [{ title: String, url: String }],
  },
  { timestamps: true }
);

export default mongoose.model("Homework", homeworkSchema);
```

---

## ðŸ§­ Table of Contents Logic (in controller)

**GET** `/courses/:courseId/toc`
â†’ Aggregate chapters for that course and return:

```json
{
  "courseName": "Python",
  "courseCode": "python",
  "totalChapters": 10,
  "tableOfContent": [
    { "chapterNumber": "1.1", "title": "áƒ¨áƒ”áƒ¡áƒáƒ•áƒáƒšáƒ˜ Python-áƒ¨áƒ˜", "homeworks": 2 },
    { "chapterNumber": "1.2", "title": "áƒªáƒ•áƒšáƒáƒ“áƒ”áƒ‘áƒ˜", "homeworks": 3 }
  ]
}
```

---

## ðŸ§° Middleware setup

```js
app.use(cors());
app.use(express.json());
app.use(helmet());
app.use(morgan("dev"));
app.use(compression());
```

Error handling:

```js
app.use((err, req, res, next) => {
  res.status(err.status || 500).json({
    success: false,
    message: err.message || "Internal Server Error",
  });
});
```

---

## ðŸ§© Validation Example (Joi)

```js
import { z } from "zod";

export const createChapterSchema = z.object({
  chapterNumber: z.string().min(1, "Chapter number is required"),
  chapterTitle: z.string().min(1, "Chapter title is required"),
  sections: z
    .array(
      z.object({
        subTitle: z.string().optional(),
        description: z.string().optional(),
        imageUrl: z.string().url().optional(),
      })
    )
    .optional(),
});
```

---

## ðŸ”— Integration with Frontend

Your frontend (Next.js) will consume these REST endpoints.
Set base URL in `.env`:

```
API_BASE_URL=http://localhost:4000/api
```

Example fetch (React Query hook):

```ts
export const getChapter = async (courseId: string, chapterId: string) => {
  const res = await fetch(
    `${process.env.NEXT_PUBLIC_API_BASE}/courses/${courseId}/chapters/${chapterId}`
  );
  if (!res.ok) throw new Error("Failed to load chapter");
  return res.json();
};
```

---

## âœ… Deliverables

1. Complete **Express + MongoDB project**
2. `.env` support (`PORT`, `MONGO_URI`, `CORS_ORIGIN`, `NODE_ENV`)
3. REST routes for **courses**, **chapters**, **homeworks**
4. **Controllers** with CRUD logic
5. **Validation** and **Error handling**
6. **DB connection setup**
7. Ready to run with:

   ```bash
   npm install
   npm run dev
   ```

8. Optionally include a small **seeder script** to populate example data (Python + HTML courses)

---

## ðŸ§¾ Example `.env`

```
PORT=4000
MONGO_URI=mongodb+srv://<username>:<password>@cluster0.mongodb.net/courses
CORS_ORIGIN=http://localhost:3000
NODE_ENV=development
```

---

## âœ… Final line

Now Iâ€™ll start sending my backend source files or drafts (controllers, models, etc.).
Please respond by structuring and implementing a **modular Express + MongoDB** backend that matches this architecture and connects properly with my Next.js frontend routes.
